---
title: "條件判斷"
description: "理解 if, switch 的差異，與三元運算、短路的運用"
date: 2023-09-01 09:59:29
keywords: [JavaScript, conditionals, 程式語言, 條件判斷, 三元運算, 短路]
slug: conditionals
---

條件判斷是控制程式運行流程的關鍵，也是最常被做成梗圖的話題，  
因為寫得好上天堂，寫不好很像波動拳（程式碼的視覺外觀），  

## if-else

if-else 是依照**判斷區間**的 true / false （括號裡的值）來決定要不要執行：

```js
let a = 1;

if(a > 0){
  console.log('a 大於 0'); // true 會執行
}
```

判斷區間除了大於、小於等等的數值比較，也經常用在判定某些變數、物件存不存在，  
因為某些特定的值是會直接判定為 false：

- undefined
- 0
- ''（空字串）
- null
- NaN

下面範例可以判斷伺服器是否有傳回來的訊息：

```js
const message = getServerData();

if (message) {
  // 有訊息時就做這邊的事
  console.log('伺服器回傳的訊息：', message);
} else {
  // 訊息有可能不存在，會是空字串、undefined、null 等等的值
  console.log('沒有訊息');
}
```
---

## switch

與 if 的判斷方式也不一樣，是 switch 容易被誤解的地方：

```js
let wallet = 300;

switch (wallet) {
  case wallet > 500:
    console.log("給我一瓶酒再給我一支菸");
    break;
  case wallet > 100:
    console.log("因為錢就是我快樂的泉源");
    break;
  default:
    console.log("把愛勇氣希望都賣了能換來多少錢");
}

// 會印出 '把愛勇氣希望都賣了能換來多少錢'
```

`case wallet > 100:` 不是有成立嗎，為何最後執行的是 default 的內容？  
因為 switch 是**拿傳入的值和 case 的值比較是否嚴格相等**，來決定是否執行該 case，  
不是拿來判斷 case 的條件成立與否。

`case wallet < 100` 看起來雖然條件成立，但這個判斷式實際上代表 true 這個值，  
也就是程式碼運行時會變成 `case true:`，而 傳入的 300 並不**嚴格相等**於 true，  
也就沒有進到 `wallet > 100` 這個 case。  

要使這個判斷成功的話只要把 `switch(wallet)` 改成 `switch(true)` 即可，  
但一般不這麼做的原因是**不符合語意**。

switch 用在判斷全部列舉出來的純值時，會比較好讀，  
也可以避免太多的巢狀結構（波動拳）。  

而判斷多個條件或變數範圍時，if-else 可能會是比較好閱讀的：

```js
// 需要判斷某個區間或有多重條件判斷就用 if-else
if(bmi > 35) {
  console.log('重度肥配');
} else if(bmi < 35 && bmi >= 30) {
  console.log('中度肥胖');
}

// 有明確可以列舉的 case
switch(option) {
  case 'A':
    console.log('選項 A 不是答案');		
    break;
  case 'B':
    console.log('選項 B 不是答案');
    break;
  case 'C':
    console.log('選項 C 是正確答案');
    break;
  default:
    console.log('你怎麼沒選答案');
}
```
---

## 三元運算
  
三元運算判斷完 true/false 後會有**回傳值**，  
如果 if 和 else 的內容都需要處理一個對應的值，可以用三元運算濃縮過程：

```js
let result = getData();
  
// if else 的寫法
if (result) {
  console.log('有資料');
} else {
  console.log('沒資料');
}

// 三元運算的寫法
console.log(result ? '有資料' : '沒資料');
```

也可以像 if-else 寫一些程式碼進去執行，如下面範例，  
不過個人還是喜歡包成函式去執行，或是用 if-else 區隔出一個空間來撰寫，  
不要犧牲可讀性折磨別人（和未來的自己）XD  
**三元運算就單純用在取值**，下面範例僅供參考，實際上我不會這樣寫。  

```js
let message = getMessage();

// 不好的寫法
message ? console.log('有訊息') : console.log('沒訊息');

// 好一點的寫法
console.log(message ? '有訊息' : '沒訊息');

// 這樣也可以
let message = getMessage() ? '有訊息' : '沒訊息';
console.log(message);
```
---

## 短路

和電路短路的意思是類似的，在程式碼裡面也可以利用邏輯判斷的方式短路生成想要的值！  

### OR ||

OR 運算裡 true 的那一邊會回傳，  
但如果兩邊都是 true，就會先回傳第一個值，  
所以「OR 是**碰到 true 就回傳**」。

如第一個值就是 true 的話就直接回傳，而跳過後面的判斷，  
這種中斷程式的方式就是短路的概念！  

下面範例是假設執行 getData() 會得到一個陣列資料，  
如果沒有取到資料就賦予一個空陣列給 data：

```js
let data = getData() || [];
// 假設 getData 會回傳陣列或 null
// 用 || 可以進行判斷後再賦予值
```

### AND &&

AND 運算裡必須要兩邊為 true 才會回傳值，回傳的是後面的值。  
如果兩邊都是 false 時會回傳第一個不成立的值，如 `null && undefined` 會回傳 `null`：

```js
console.log("有東西" && "真的有東西"); // "真的有東西"
console.log(null && "有東西"); // null
console.log(null && undefined); // null
```

AND 的短路邏輯是要兩邊都成立，因此一定得判斷到後面的那一個才知道有無成立，  
回傳的也是後面那一個。  

當然短路和三元運算值一樣，也可以寫入一些可執行的程式碼，  
如 `isChecked && sendRequest()`。  

最後要注意如果同時有 AND 與 OR 的比較，AND 會優先執行！

### 問號問號 ??

請正名為「空值合併運算子」XD  
`??` 是比較特別的短路，假設第一個值是 `null` 或 `undefined` 則回傳右邊的值，  
因此第一個值是 `0` 或是空字串時就不會判斷到後面：

```js
console.log(null ?? "有東西"); // "有東西"
console.log('' ?? "這裡也有東西"); // ''
```

---
## 例外排除

剛開始刷題一定很常遇到有些不合法的值忘記要排除，  
撰寫流程判斷時，其實很常在第一個條件就過濾掉，  
不希望在進行了一連串的判斷後才發現這個值不合法，造成無謂的效能損耗：

```js
function showBodyCondition(bmi) {
  // 把不合法的條件移到第一個
  if(isNaN(bmi) || typeof bmi !== 'number') {
    console.log('請輸入合法的數字');
  } else if(bmi < 17.5) {
    console.log('過輕');
  }
  //...
}
```

另外 **early return** 也是很常使用的技巧！  
在函式內只要執行到 return ，後面的程式碼就不會再執行，並且跳脫這個函式，  
如下面範例，showPokemonData 的函式內一開始就先判斷資料是否還在讀取或者資料不存在：

```js
function showPokemonData(data) {
  if(isLoading || !data) {
    return;
  }

  console.log(data);
}
```

---
## 參考資料

- [IF ELSE 與 SWITCH CASE 的比較](https://jameshsu0407.github.io/blog/20211023_if-else_switch-case/)
- [三元運算子（Ternary Operator）和布林值混用的簡化方法](https://medium.com/@yuhsienyeh/%E4%B8%89%E5%85%83%E9%81%8B%E7%AE%97%E5%AD%90-ternary-operator-%E5%92%8C%E5%B8%83%E6%9E%97%E5%80%BC%E6%B7%B7%E7%94%A8%E7%9A%84%E7%B0%A1%E5%8C%96%E6%96%B9%E6%B3%95-6bb70375fd65)
- [Logical AND (&&)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_AND)
- [空值合并运算符](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing)
