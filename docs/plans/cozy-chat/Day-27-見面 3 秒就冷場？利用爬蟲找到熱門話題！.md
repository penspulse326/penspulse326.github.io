---
title: 'Day 27 - -è¦‹é¢ 3 ç§’å°±å†·å ´ï¼Ÿåˆ©ç”¨çˆ¬èŸ²æ‰¾åˆ°ç†±é–€è©±é¡Œï¼'
description: 'Cozy Chat å°ˆæ¡ˆç¬¬ 27 å¤©ï¼š-è¦‹é¢ 3 ç§’å°±å†·å ´ï¼Ÿåˆ©ç”¨çˆ¬èŸ²æ‰¾åˆ°ç†±é–€è©±é¡Œï¼'
date: '2025-09-28 00:00:00'
keywords: ['Cozy Chat', 'å³æ™‚é€šè¨Š', 'WebSocket', 'å°ˆæ¡ˆå¯¦ä½œ']
tags: ['Cozy Chat', 'å°ˆæ¡ˆé–‹ç™¼', 'å³æ™‚é€šè¨Š']
slug: 'cozy-chat-day27'
---

![gh](https://raw.githubusercontent.com/penspulse326/penspulse326.github.io/images/1759140913000us66v3.png)

ä¸è«–ç¶²è·¯é‚„æ˜¯ç”Ÿæ´»ä¸Šçš„ç¤¾äº¤ï¼Œé›£å…éƒ½æœƒæœ‰ä¸çŸ¥é“è¦èŠä»€éº¼çš„æ™‚å€™ï¼Œå¦‚æœä¸å¸¸çœ‹æ–°èæˆ–ç¤¾ç¾¤åª’é«”ï¼Œä¸€æ™‚ä¹‹é–“é‚„çœŸçš„æœƒå†·å ´......é€™æ™‚å€™å°±é€éç³»çµ±æ¨è–¦çš„è©±é¡Œä¾†äº‚èŠä¸€é€šå§ï¼

## åŠŸèƒ½åˆ†æ

é€™æ¬¡çš„çˆ¬èŸ²åŠŸèƒ½ä¸»è¦æ˜¯æˆ‘åœ¨è®€æ›¸æœƒçœ‹åˆ°æœ‰ä¼™ä¼´é€™éº¼åšï¼Œè¦ºå¾—è¶…ä¸è¶…å¯¦ç”¨æ‰€ä»¥è©¦è‘—åšåšçœ‹ XD

ç¨‹å¼é‚è¼¯éå¸¸å°‘ï¼š

1. ä½¿ç”¨ puppeteer çˆ¬å– [Google Trends](https://trends.google.com.tw/trending?geo=TW) çš„å…§å®¹
2. å°‡å…§å®¹å¯«å…¥åˆ° JSON æª”

å…¶ä»–çš„éƒ¨åˆ†æ˜¯è‡ªå‹•åŒ–çš„è¨­å®šï¼š

1. è¨­è¨ˆ GitHub Actions çš„ workflowï¼Œåˆ©ç”¨æ’ç¨‹æ¯ 30 åˆ†é˜åŸ·è¡Œ puppeteer è…³æœ¬
2. workflow æœ€å¾ŒæœƒåŸ·è¡Œ `git push` ä¾†æ¨é€æœ€æ–°çš„ JSON æª”
3. GitHub å¯ä»¥é€éæŸ¥çœ‹ raw file çš„æ–¹å¼ç›´æ¥è¨ªå•é€™å€‹ JSON æª”çš„ç¶²å€

ä¸éé€™å€‹åŠŸèƒ½æˆ‘ä¸æƒ³è¦è·Ÿå°ˆæ¡ˆæœ¬é«”æ±™æŸ“ï¼Œæ‰€ä»¥æœƒå¦å¤–é–‹ä¸€å€‹ GitHub Repository ä¾†ç®¡ç†ã€‚

---

## è…³æœ¬

æˆ‘ä¹Ÿæ²’æœ‰ç”¨éçˆ¬èŸ²ï¼Œæ‰€ä»¥æˆ‘å°±ç›´æ¥ Vibe Coding äº†ï¼Œè«‹å¤§å®¶ä¸è¦æ‰æˆ‘ï¼ˆï¼Ÿï¼‰ã€‚

å› ç‚º Google Trends çš„å…§å®¹ä¸æ˜¯éœæ…‹çš„ï¼Œå’Œä¸€èˆ¬ SPA ä¸€æ¨£éœ€è¦è€—è²»ä¸€é»æ™‚é–“å‹•æ…‹è¼‰å…¥ï¼Œæ‰€ä»¥é€ééœ€è¦ä¸‹é€™å€‹åƒæ•¸ `waitUntil: 'networkidle0'` ç­‰å¾…è¡¨æ ¼å…§å®¹é•·å‡ºä¾†ã€‚

é–‹å§‹æ“·å–å…ƒç´ ä¹‹å‰ï¼Œä¸€å®šè¦å…ˆçœ‹éè¡¨æ ¼çš„ HTML å¤§æ¦‚é•·æ€æ¨£ï¼Œå› ç‚ºå‹•æ…‹è¼‰å…¥çš„å…§å®¹é‚„è »å¤šçš„ï¼Œç›´æ¥å« AI æ‰¾çš„è©±ï¼Œä¸Šä¸‹æ–‡çš„é‡å¯èƒ½æœƒè®“ AI æ²’æœ‰è¾¦æ³•å¾ˆæº–ç¢ºåœ°æ‰¾åˆ°æˆ‘å€‘æƒ³è¦çš„æ–‡æœ¬ï¼š

![gh](https://raw.githubusercontent.com/penspulse326/penspulse326.github.io/images/1759065395000yroeb7.png)

çœ‹ `class` å°±çŸ¥é“éƒ½æ˜¯å‹•æ…‹ç”Ÿæˆçš„å…§å®¹ï¼Œæ‰€ä»¥æ²’è¾¦æ³•å¾ˆè¼•é¬†åœ°æ‰¾åˆ°å›ºå®šçš„å…ƒç´  QQ

å¦‚æœæ“·å–ä¸åˆ°ç›®æ¨™å…ƒç´ çš„è©±å¯ä»¥æª¢æŸ¥æ˜¯ä¸æ˜¯ `querySelector` çš„é¸æ“‡å™¨ä¸‹éŒ¯äº†ï¼š

```js
const puppeteer = require('puppeteer');
const fs = require('fs');

async function getGoogleTrends() {
  const browser = await puppeteer.launch({
    headless: false,
    args: ['--no-sandbox', '--disable-setuid-sandbox'],
  });
  const page = await browser.newPage();

  await page.goto('https://trends.google.com.tw/trending?geo=TW&hours=4', {
    waitUntil: 'networkidle0',
  });

  try {
    await page.waitForSelector('td', { timeout: 10000 });
  } catch (error) {
    console.log('ç­‰å¾…å…ƒç´ è¼‰å…¥è¶…æ™‚');
    await browser.close();
    return;
  }

  const trends = await page.evaluate(() => {
    const allRows = Array.from(document.querySelectorAll('tbody tr'));

    return allRows
      .map((row) => {
        const cells = Array.from(row.querySelectorAll('td'));
        if (cells.length > 1) {
          const trendCell = cells[1];
          if (trendCell) {
            const firstDiv = trendCell.querySelector('div');
            const text = firstDiv?.textContent?.trim() || '';
            if (text) {
              return { content: text };
            }
          }
        }
        return null;
      })
      .filter((item) => item !== null);
  });

  console.log('æ“·å–åˆ°çš„è¶¨å‹¢ï¼š', trends);

  await browser.close();

  const output = {
    updated: new Date().toISOString(),
    trends: trends,
  };

  fs.writeFileSync('google-trends.json', JSON.stringify(output, null, 2));
  console.log('Google Trends è³‡æ–™å·²å„²å­˜è‡³ google-trends.json');
}

getGoogleTrends();
```

æ¥è‘—å°±å¯ä»¥åŸ·è¡Œçœ‹çœ‹çˆ¬å–çš„çµæœï¼š ``

```json
{
  "updated": "2025-09-28T12:09:23.995Z",
  "trends": [
    {
      "content": "äºéŒ¦è³½ç›´æ’­"
    }
  ]
}
```

ä¸éåŸ·è¡ŒæˆåŠŸä¸ä»£è¡¨æ²’äº‹ï¼ŒGoogle å¯èƒ½é‚„æ˜¯æœƒé‡å°çˆ¬èŸ²æ©Ÿå™¨äººåšä¸€äº›é™åˆ¶ï¼ŒæŸå¤©å¯èƒ½æˆ‘å€‘çš„è…³æœ¬å°±çªç„¶çˆ¬ä¸åˆ°äº†ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šä¸€äº›ç€è¦½å™¨è³‡æ–™çš„å½é€ ï¼Œé‚„æœ‰éš¨æ©Ÿå»¶é²æ™‚é–“ä¾†æ¨¡æ“¬äººé¡çš„è¡Œç‚ºï¼š

```ts
const puppeteer = require('puppeteer');
const fs = require('fs');

// è¨­å®šéš¨æ©Ÿ User-Agent
  const userAgents = [
    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36',
    'Mozilla/5.0 (Macintosh; Intel Mac OS X 13_5_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Safari/605.1.15',
    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Edge/124.0.0.0 Safari/537.36',
    'Mozilla/5.0 (iPhone; CPU iPhone OS 17_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.4 Mobile/15E148 Safari/604.1',
  ];
  const randomUserAgent =
    userAgents[Math.floor(Math.random() * userAgents.length)];

  const browser = await puppeteer.launch({
    headless: true,
    args: ['--no-sandbox', '--disable-setuid-sandbox'],
  });
  const page = await browser.newPage();

  // è¨­å®š User-Agent
  await page.setUserAgent(randomUserAgent);

  // è¨­å®šè¦–çª—å¤§å°
  await page.setViewport({ width: 1920, height: 1080 });

  // åŠ å…¥éš¨æ©Ÿå»¶é² (2-5ç§’)
  const randomDelay = Math.floor(Math.random() * 3000) + 2000;
  console.log(`ç­‰å¾… ${randomDelay}ms...`);
  await new Promise((resolve) => setTimeout(resolve, randomDelay));

  // ç•¥
}
```

çˆ¬èŸ²çš„é‚è¼¯å°±å·®ä¸å¤šå®Œæˆå•¦ï¼

---

## GitHub Actions

åœ¨é–‹å§‹è¨­å®š workflow ä¹‹å‰ï¼Œè¦å…ˆå» Repository è¨­å®šè‡ªå‹•åŒ–ä½œæ¥­çš„æ¬Šé™ï¼Œåœ¨ Settings > Actions > Generalï¼Œå…è¨± GitHub Actions è®€å¯«æ•´å€‹å°ˆæ¡ˆï¼š

![gh](https://raw.githubusercontent.com/penspulse326/penspulse326.github.io/images/1759060898000of7v17.png)

ç„¶å¾Œåœ¨æ ¹ç›®éŒ„æ–°å¢ `.github/workflows/update-trends.yml`ï¼š

```yml
name: Update Google Trends

on:
  push:
    branches:
      - google-trends
  schedule:
    - cron: '5,35 * * * *' # æ¯å°æ™‚ç¬¬ 5 å’Œ 35 åˆ†é˜åŸ·è¡Œ
  workflow_dispatch: # ä¿ç•™æ‰‹å‹•è§¸ç™¼çš„é¸é …

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install pnpm
        run: npm install -g pnpm

      - name: Install dependencies
        run: pnpm install

      - name: Force install Chromium for Puppeteer
        run: npx puppeteer browsers install chrome

      - name: Run Puppeteer Scraper
        run: pnpm run start

      - name: Commit and Push Results
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # ä¿å­˜çˆ¬èŸ²çš„æ–°è³‡æ–™
          cp google-trends.json /tmp/google-trends.json

          # æ‹‰å–æœ€æ–°çš„ç¨‹å¼ç¢¼
          git pull origin google-trends

          # æŠŠæ–°çˆ¬åˆ°çš„è³‡æ–™è¦†è“‹å›å»
          cp /tmp/google-trends.json google-trends.json

          # æäº¤ä¸¦æ¨é€
          git add google-trends.json
          git commit -m "update google trends [CI] $(TZ=Asia/Taipei date '+%Y-%m-%d %H:%M:%S')" || echo "Nothing to commit"
          git push https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git HEAD:google-trends
```

é€™å€‹ workflow çš„è¡Œç‚ºå°±ç­‰åŒæ–¼æˆ‘å€‘åœ¨æœ¬æ©ŸåŸ·è¡Œäº†çˆ¬èŸ²ï¼Œç„¶å¾Œå†åš `git push` æ›´æ–°è³‡æ–™ã€‚åªæ˜¯é€™æ®µæµç¨‹æ”¹ç‚ºé€é GitHub Actions æä¾›çš„ `schedule: - cron:` æ’ç¨‹åŠŸèƒ½å¹«æˆ‘å€‘å®šæ™‚åŸ·è¡Œï¼š

![gh](https://raw.githubusercontent.com/penspulse326/penspulse326.github.io/images/17591415550008i2py4.png)

æ¨é€çš„æ™‚å€™æˆ‘æœ‰å…ˆå°‡ JSON è¨­ç‚ºç©ºé™£åˆ—ï¼Œæ¸¬è©¦çœ‹çœ‹è…³æœ¬æœ‰æ²’æœ‰è¢«è§¸ç™¼ï¼Œè®“ JSON è¢«å¯«å…¥ï¼š

![gh](https://raw.githubusercontent.com/penspulse326/penspulse326.github.io/images/1759061467000shn7rk.png)

ç¢ºå®šå¯ä»¥è§¸ç™¼ä¹‹å¾Œå°±å¯ä»¥é€éæ‹¿åˆ° raw file çš„ URL æ‹¿åˆ°åŸå§‹çš„ JSON å…§å®¹å•¦ï¼

![gh](https://raw.githubusercontent.com/penspulse326/penspulse326.github.io/images/1759061577000wreep3.png)

:::warning
workflow å¦‚æœæœ‰è¨­å®šæ’ç¨‹çš„è©±ï¼Œé è¨­åˆ†æ”¯ï¼ˆdefault branchï¼‰è£¡é¢ä¸€å®šè¦æœ‰é€™æ”¯ workflowï¼Œå¦å‰‡æ’ç¨‹æ˜¯ä¸æœƒç”Ÿæ•ˆçš„ã€‚
:::

---

## å‰ç«¯å–å¾—è³‡æ–™

å› ç‚ºæˆ‘å€‘è¨­è¨ˆäº†å®šæ™‚çˆ¬èŸ²ï¼Œæ‰€ä»¥é€™ä»½æ¸…å–®è‡³å°‘åœ¨æ’ç¨‹çš„é–“éš”å…§æ˜¯å›ºå®šä¸è®Šçš„ï¼Œé‚£éº¼å‰ç«¯å…¶å¯¦å°±ä¸éœ€è¦æ¯æ¬¡é…å°çš„æ™‚å€™éƒ½å»æ‰“ APIï¼Œé€™æ™‚å°±å¯ä»¥ç™¼æ® Next çš„å„ªå‹¢ï¼

åŸæœ¬é¦–é éƒ½æ˜¯é€é `use client` å®£å‘Šçš„å…§å®¹ï¼Œæ‰€ä»¥å…ˆåˆ†é›¢åˆ°å…¶ä»–æª”æ¡ˆï¼Œå†ä¾†å°±å¯ä»¥æ–½å±•é­”æ³•ï¼Œåˆ©ç”¨ Next å°è£éçš„ `fetch` æŠŠè³‡æ–™å¿«å–èµ·ä¾†ä¸¦è¨­å®š `revalidate` ç‚º 30 åˆ†é˜ï¼š

```ts
import ClientPage from './client-page';

async function getTrends() {
  const res = await fetch(
    'https://penspulse326.github.io/cozy-chat/google-trends.json',
    {
      next: {
        revalidate: 1800, // 30 åˆ†é˜
      },
    }
  );

  if (!res.ok) {
    throw new Error('Failed to fetch trends');
  }

  return res.json();
}

export default async function Home() {
  const data = await getTrends();

  return <ClientPage trends={data.trends} />;
}
```

æŒ‡å®šé é¢é‡æ–°ç”Ÿæˆçš„é€±æœŸï¼Œå¯ä»¥è®“æ‰€æœ‰é€£ä¸Šä¾†çš„ä½¿ç”¨è€…éƒ½æš«æ™‚é–±è®€åˆ°åŒä¸€æ‰¹éœæ…‹è³‡æ–™é é¢ï¼Œé€™ç¨®æ–¹å¼ä¹Ÿç¨±ä½œ ISRï¼Œæ˜¯å»¶ä¼¸è‡ª SSG çš„ä¸€ç¨®æ¸²æŸ“æ–¹å¼ã€‚

æ‹¿åˆ°çš„è³‡æ–™å†é€é `props` ä¸€è·¯å¾€ä¸‹å‚³çµ¦è¨Šæ¯ç›’ï¼

æœå°‹è¶¨å‹¢çš„æ¸…å–®é•·åº¦æ˜¯ä¸å®šçš„ï¼Œä½†å¤§å¤šæ™‚å€™éƒ½æœƒæœ‰åå¤šç­†ï¼Œä¸å¯èƒ½åœ¨ç•«é¢ä¸Šæ¨è–¦è©±é¡Œçš„æ™‚å€™ï¼Œå…¨éƒ¨åˆ—å‡ºä¾†ï¼ˆ~~å…ˆè¢«ç³»çµ±æ´—é »ä¸€æ³¢~~ï¼‰ï¼Œæ‰€ä»¥æˆ‘è¨­å®šéš¨æ©Ÿå–å‡º 5 ç­†ï¼Œä½æ–¼ 5 ç­†å°±å…¨éƒ¨å–å‡ºï¼š

```tsx
const filteredTrends = trends
  .filter((trend: { content: string }) => trend.content !== '')
  .sort(() => Math.random() - 0.5)
  .slice(0, Math.min(5, trends.length));
```

æ¨è–¦è©±é¡Œçš„æ™‚å€™æœƒæ’å…¥ Google æœå°‹çµæœçš„ URLï¼Œæ ¼å¼æ˜¯é€™æ¨£ï¼š

![gh](https://raw.githubusercontent.com/penspulse326/penspulse326.github.io/images/1759063472000rda4ll.png)

æ‰€ä»¥åªè¦æ›¿æ›æ‰ `q=` é€™æ®µ query string çš„å…§å®¹å³å¯ï¼š

```tsx
{
  filteredTrends.map((trend: { content: string }) => (
    <Text className={styles.chatBoxTopic}>
      ä¾†èŠèŠ
      <Link
        href={`https://www.google.com.tw/search?q=${trend.content}&hl=zh-TW`}
        target="_blank"
        rel="noopener noreferrer"
      >
        {trend.content}
      </Link>
      å§
    </Text>
  ));
}
```

ä¾†å°¬èŠä¸€æ³¢å§ï¼

![gh](https://raw.githubusercontent.com/penspulse326/penspulse326.github.io/images/1759063905000b7daxr.png)

---

## æœ¬æ—¥å°çµ

é›–ç„¶å¤§æ¦‚çŸ¥é“çˆ¬èŸ²åœ¨åšä»€éº¼ï¼Œä½†å¯¦éš›å»çœ‹ç¨‹å¼ç¢¼é‹ä½œçš„éç¨‹é‚„æ˜¯é ­ä¸€é­ï¼åŒ…å«ç„¡é ­ç€è¦½å™¨ã€ç€è¦½å™¨å½é€ ç­‰ç­‰ï¼Œç®—æ˜¯é€é Vibe Coding å­¸åˆ°äº†æ–°çŸ¥è­˜ï¼

Next App Router ä¹ŸæŠŠ server side å–è³‡æ–™çš„æ–¹å¼è®Šç°¡å–®äº†ï¼Œå…¨éƒ¨éƒ½åœ¨ Page å…ƒä»¶å‘¼å« `fetch` ä¸¦è¨­å®šå¥½å¿«å–æ™‚é–“å³å¯ï¼Œå¦‚æœæ˜¯ä»¥å‰çš„ Page Router å°±...æ¦‚å¿µä¹Ÿå·®ä¸å¤šï¼Œåªæ˜¯è¦å‘¼å« `getStaticProps` æˆ– `getServerSideProps`ï¼Œä½†æˆ‘åœ¨å°ˆé¡Œæ™‚æœŸç”¨å¾—ä¸å¤šï¼Œå¾Œä¾†å†ç¢° Next çš„æ™‚å€™éƒ½æ˜¯å¯« App Router äº†ï¼Œä¸æ›‰å¾—æœ‰æ²’æœ‰ç™¼ç”Ÿéä»€éº¼å®—æ•™æˆ°çˆ­ XD

---

## åƒè€ƒè³‡æ–™

- [ğŸ”¥ Hot Now çˆ¬èŸ²å°ˆæ¡ˆ](https://github.com/garylin0969/trend-scraper)
